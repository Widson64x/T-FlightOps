{% extends "Base.html" %}

{% block titulo %}Monitoramento A√©reo | Luft-ConnectAir{% endblock %}

{% block conteudo %}
{% include "Components/_ModalCtc.html" %}

<link rel="stylesheet" href="{{ url_for('static', filename='CSS/Planejamento/Index.css') }}">

<header class="app-header">
    <div class="header-content">
        <div class="logo-area">
            <i class="ph-duotone ph-airplane-tilt logo-icon"></i>
            <div>
                <h1>Painel de Planejamento</h1>
                <p class="subtitle" id="data-extenso">Carregando data...</p>
            </div>
        </div>
        <div class="user-area">
            <a href="{{ url_for('Planejamento.MapaGlobal') }}" class="btn-icon-only" title="Mapa Global"><i class="ph-bold ph-globe-hemisphere-west"></i></a>
        </div>
    </div>
</header>

<main class="app-main">
    
    <section class="top-section">
        <div class="kpi-container">
            <div class="kpi-card kpi-blue">
                <div class="kpi-icon"><i class="ph-duotone ph-package"></i></div>
                <div class="kpi-info"><span class="kpi-label">Total CT-e</span><span class="kpi-value" id="kpi-total">0</span></div>
            </div>
            <div class="kpi-card kpi-orange">
                <div class="kpi-icon"><i class="ph-duotone ph-scales"></i></div>
                <div class="kpi-info"><span class="kpi-label">Peso Total</span><span class="kpi-value"><span id="kpi-peso">0</span> kg</span></div>
            </div>
            <div class="kpi-card kpi-green">
                <div class="kpi-icon"><i class="ph-duotone ph-currency-circle-dollar"></i></div>
                <div class="kpi-info"><span class="kpi-label">Valor Total</span><span class="kpi-value">R$ <span id="kpi-valor">0,00</span></span></div>
            </div>
            <div class="kpi-card kpi-purple">
                <div class="kpi-icon"><i class="ph-duotone ph-receipt"></i></div>
                <div class="kpi-info"><span class="kpi-label">Qtd. Notas</span><span class="kpi-value" id="kpi-notas">0</span></div>
            </div>
        </div>

        <div class="tabs-wrapper">
            <div class="tabs-container">
                <button class="tab-btn active" onclick="MudarAba('TODOS')" id="tab-todos"><i class="ph-bold ph-squares-four"></i> Vis√£o Global</button>
                <button class="tab-btn" onclick="MudarAba('DIARIO')" id="tab-diario"><i class="ph-bold ph-sun"></i> Do Dia</button>
                <button class="tab-btn" onclick="MudarAba('BACKLOG')" id="tab-backlog"><i class="ph-bold ph-clock-counter-clockwise"></i> Backlog</button>
                <button class="tab-btn" onclick="MudarAba('REVERSA')" id="tab-reversa"><i class="ph-bold ph-arrow-u-up-left"></i> Reversa</button>
            </div>
        </div>
    </section>

    <section class="content-card">
        <div class="toolbar-container">
            <div class="search-box">
                <i class="ph-bold ph-magnifying-glass"></i>
                <input type="text" id="input-busca" placeholder="Buscar por CTC, cidade, cliente..." onkeyup="FiltrarTabela()">
            </div>
            <div class="filters-box">
                <div class="select-wrapper">
                    <i class="ph-bold ph-flag-banner"></i>
                    <select id="filtro-prioridade" onchange="FiltrarTabela()">
                        <option value="TODOS">Todas Prioridades</option>
                        <option value="URGENTE">‚ö†Ô∏è Apenas Urgentes</option>
                        <option value="AGENDADA">üìÖ Apenas Agendadas</option> <option value="NORMAL">‚úÖ Apenas Normais</option>
                    </select>
                </div>
                <div class="select-wrapper">
                    <i class="ph-bold ph-storefront"></i>
                    <select id="filtro-filial" onchange="FiltrarTabela()"><option value="TODOS">Todas Filiais</option></select>
                </div>
                <div class="select-wrapper">
                    <i class="ph-bold ph-info"></i>
                    <select id="filtro-motivo" onchange="FiltrarTabela()"><option value="TODOS">Todos Motivos</option></select>
                </div>
            </div>
        </div>

        <div id="transition-container" class="table-responsive">
            <table class="modern-table">
            <thead>
                <tr>
                    <th style="text-align: center;">A√ß√µes</th> 
                    <th onclick="Ordenar('status_planejamento')">Status</th>
                    <th onclick="Ordenar('prioridade')" style="text-align: center;" title="Prioridade">Prio.</th>
                    <th onclick="Ordenar('origem_dados')">Tipo</th>
                    <th onclick="Ordenar('ctc')">CTC / S√©rie</th>
                    <th onclick="Ordenar('unid_lastmile')" style="text-align: center;">U. Dest.</th> 
                    <th onclick="Ordenar('data_raw')">Emiss√£o <i id="seta-data_raw" class="ph-bold ph-arrow-down"></i></th>
                    <th>Origem <i class="ph-bold ph-arrow-right flow-icon"></i> Destino</th>
                    <th onclick="Ordenar('remetente')">Cliente / Tipo Carga</th>
                    <th onclick="Ordenar('qtd_notas')" style="text-align: center;" title="NFs">NFs</th> 
                    <th onclick="Ordenar('volumes')" style="text-align: right;">Vols.</th>
                    <th onclick="Ordenar('peso_taxado')" style="text-align: right;">Peso F√≠s. / Tax.</th>
                    <th onclick="Ordenar('raw_val_mercadoria')" style="text-align: right;">Valor</th>
                </tr>
            </thead>
                <tbody id="table-body">
                    <tr><td colspan="13" style="text-align: center; padding: 40px;">Carregando dados...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="table-footer">
            <div id="contador-registros">Mostrando 0 registros</div>
        </div>
    </section>

</main>

<script>
    const URL_API_LISTAR = "{{ url_for('Planejamento.ApiCtcsHoje') }}";
    const URL_BASE_MONTAR = "{{ url_for('Planejamento.MontarPlanejamento', filial='__F__', serie='__S__', ctc='__C__') }}";
</script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="{{ url_for('static', filename='JS/Planejamento/Index.js') }}" defer></script>
{% endblock %}