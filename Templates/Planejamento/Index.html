{% extends "Base.html" %}

{% block titulo %}Monitoramento Aéreo | FlightOps{% endblock %}

{% block conteudo %}
{% include "Components/_ModalCtc.html" %}
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/Planejamento/Index.css') }}">
<div class="monitoring-dashboard">

    <div class="dash-header">
        <div class="header-title">
            <h2>
                Monitoramento de Cargas
                <div class="live-indicator"><div class="live-dot"></div>RT-10s</div>
            </h2>
            <div class="header-subtitle">
                <i class="ph-bold ph-calendar-blank"></i> <span id="data-extenso"></span>
                <span style="margin: 0 8px; color: var(--cor-borda);">|</span>
                <span id="contador-linhas">0 registros</span>
            </div>
        </div>

        <a href="{{ url_for('Planejamento.MapaGlobal') }}" class="btn-action-primary">
            <i class="ph-bold ph-globe-hemisphere-west"></i> Diário de Voos
        </a>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-icon icon-blue"><i class="ph-duotone ph-files"></i></div>
            <div class="kpi-info"><span class="kpi-label">Documentos Hoje</span><span class="kpi-value" id="kpi-docs">0</span></div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon icon-orange"><i class="ph-duotone ph-scales"></i></div>
            <div class="kpi-info"><span class="kpi-label">Peso Taxado Total</span><span class="kpi-value" id="kpi-peso">0 kg</span></div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon icon-green"><i class="ph-duotone ph-currency-dollar"></i></div>
            <div class="kpi-info"><span class="kpi-label">Faturamento Estimado</span><span class="kpi-value" id="kpi-fat">R$ 0,00</span></div>
        </div>
    </div>

    <div class="toolbar-container">
        <div class="search-group">
            <i class="ph-bold ph-magnifying-glass"></i>
            <input type="text" id="input-busca" class="input-filter" placeholder="Buscar CTC, Cidade, Cliente..." onkeyup="FiltrarTabela()">
        </div>
        
        <select id="filtro-prioridade" class="select-filter" onchange="FiltrarTabela()">
            <option value="TODOS">Todas Prioridades</option>
            <option value="URGENTE">⚠️ Apenas Urgentes</option>
            <option value="NORMAL">✅ Apenas Normais</option>
        </select>

        <select id="filtro-filial" class="select-filter" onchange="FiltrarTabela()">
            <option value="TODOS">Todas Filiais</option>
        </select>
    </div>

    <div class="table-container">
        <div class="table-scroll-area">
            <table class="flight-table">
                <thead>
                    <tr>
                        <th style="text-align: center; width: 90px;">Ação</th>
                        <th style="text-align: center; width: 110px;">Status Plan.</th>
                        
                        <th onclick="Ordenar('filial')" style="text-align: center; width: 80px;">Filial <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th onclick="Ordenar('ctc')" style="width: 120px;">CTC <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        
                        <th onclick="Ordenar('tipo_carga')" style="width: 120px;">Tipo Carga <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        
                        <th onclick="Ordenar('data_raw')" style="width: 100px;">Emissão <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th onclick="Ordenar('prioridade')" style="text-align: center; width: 100px;">Prio <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th onclick="Ordenar('status_ctc')" style="text-align: center; width: 120px;">Status CTC <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th style="text-align: center;">LastMile</th>
                        <th style="width: 140px;">Rota</th>
                        <th>Remetente / Destinatário</th>
                        <th onclick="Ordenar('volumes')" style="text-align: right;">Vol. <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th onclick="Ordenar('raw_val_mercadoria')" style="text-align: right;">Valor <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                        <th onclick="Ordenar('peso_taxado')" style="text-align: right;">Peso <i class="ph-bold ph-caret-up-down sort-icon"></i></th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr><td colspan="15"><div class="empty-state"><i class="ph-duotone ph-airplane-tilt"></i><span>Carregando dados...</span></div></td></tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
    // --- LÓGICA INTELIGENTE (CLIENT-SIDE) ---
    const URL_API_LISTAR = "{{ url_for('Planejamento.ApiCtcsHoje') }}";
    const URL_BASE_MONTAR = "{{ url_for('Planejamento.MontarPlanejamento', filial='__F__', serie='__S__', ctc='__C__') }}";
</script>
<script src="{{ url_for('static', filename='JS/Planejamento/Index.js') }}" defer></script>
{% endblock %}