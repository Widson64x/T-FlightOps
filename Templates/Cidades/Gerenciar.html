{% extends "Base.html" %}

{% block titulo %}Base de Cidades | FlightOps{% endblock %}

{% block conteudo %}

<style>
    /* Estilos Globais */
    .page-grid { display: grid; grid-template-columns: 350px 1fr; gap: 25px; height: calc(100vh - 145px); }
    @media (max-width: 1100px) { .page-grid { grid-template-columns: 1fr; height: auto; } }
    
    .painel { background: var(--cor-fundo-painel); border: 1px solid var(--cor-borda); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
    .painel-header { padding: 18px 25px; border-bottom: 1px solid var(--cor-borda); background: var(--cor-fundo-principal); font-weight: 600; }
    .painel-body { padding: 25px; flex: 1; overflow-y: auto; }
    .painel-tabela .painel-body { padding: 0; }
    
    .upload-zone { border: 2px dashed var(--cor-borda); border-radius: 8px; padding: 40px 20px; text-align: center; cursor: pointer; transition: 0.2s; background: rgba(0,0,0,0.01); }
    .upload-zone:hover { border-color: var(--cor-primaria); background: rgba(0, 86, 179, 0.04); }
    
    .table-custom { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    .table-custom th { background: #f8f9fa; padding: 14px 20px; text-align: left; position: sticky; top: 0; border-bottom: 1px solid var(--cor-borda); }
    .table-custom td { padding: 14px 20px; border-bottom: 1px solid var(--cor-borda); }
    
    .status-active { color: #155724; background: #d4edda; padding: 4px 8px; border-radius: 20px; font-weight: 600; font-size: 0.75rem; width: fit-content; }
    
    /* Modal */
    .modal-backdrop { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    .modal-content { background: var(--cor-fundo-painel); width: 420px; padding: 35px; border-radius: 12px; text-align: center; border: 1px solid var(--cor-borda); }
</style>

{% if ExibirModal %}
<div class="modal-backdrop">
    <div class="modal-content">
        <h3 style="color: #dc3545;">‚ö†Ô∏è Base Existente</h3>
        <p style="margin: 20px 0;">J√° existe uma base de cidades ativa.<br>Deseja substituir pela nova?</p>
        <form method="POST" style="display: flex; gap: 10px; justify-content: center;">
            <input type="hidden" name="confirmar_substituicao" value="true">
            <input type="hidden" name="caminho_temp" value="{{ DadosModal.caminho_temp }}">
            <input type="hidden" name="nome_arquivo" value="{{ DadosModal.nome_arquivo }}">
            <input type="hidden" name="mes_ref" value="{{ DadosModal.mes_ref }}">
            <a href="{{ url_for('Cidade.Gerenciar') }}" class="btn-primario" style="background: #ccc; color: #333; text-decoration: none;">Cancelar</a>
            <button type="submit" class="btn-primario" style="background: #dc3545;">Substituir</button>
        </form>
    </div>
</div>
{% endif %}

<div style="margin-bottom: 20px;">
    <h2 style="font-size: 1.2rem; font-weight: 700;">üèôÔ∏è Base de Cidades</h2>
    <p style="color: #666; font-size: 0.9rem;">Cadastro de Munic√≠pios e Coordenadas (XLSX).</p>
</div>

<div class="page-grid">
    <div class="painel" style="height: fit-content;">
        <div class="painel-header">Nova Importa√ß√£o</div>
        <div class="painel-body">
            <form method="POST" enctype="multipart/form-data">
                <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 10px; display: block;">Arquivo Cidades (.xlsx)</label>
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 2rem;">üì§</div>
                    <div style="font-size: 0.9rem; font-weight: 600;">Clique para Upload</div>
                    <input type="file" id="fileInput" name="arquivo_xlsx" accept=".xlsx" style="display: none;" onchange="this.form.submit()">
                </div>
            </form>
        </div>
    </div>

    <div class="painel painel-tabela">
        <div class="painel-header">Hist√≥rico de Vers√µes</div>
        <div class="painel-body">
            <table class="table-custom">
                <thead>
                    <tr><th>Data Upload</th><th>Arquivo</th><th>Respons√°vel</th><th>Status</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody>
                    {% for item in ListaRemessas %}
                    <tr>
                        <td>{{ item.DataUpload.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>{{ item.NomeArquivoOriginal }}</td>
                        <td>{{ item.UsuarioResponsavel }}</td>
                        <td>{% if item.Ativo %}<div class="status-active">Ativo</div>{% else %}Hist√≥rico{% endif %}</td>
                        <td>
                            <a href="{{ url_for('Cidade.Excluir', id_remessa=item.Id) }}" onclick="return confirm('Excluir?')" style="text-decoration:none;">‚ùå</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" style="text-align: center; padding: 20px;">Nenhuma base carregada.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}