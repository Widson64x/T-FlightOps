<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block titulo %}FlightOps{% endblock %}</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/Temas.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/Global.css') }}">
</head>
<body>
    <div class="layout-wrapper">
        <aside class="sidebar" id="sidebar">
            <button onclick="ToggleSidebar()" class="sidebar-toggle-btn" title="Expandir/Recolher">
                <i class="ph-bold ph-caret-left"></i>
            </button>

            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="ph-fill ph-airplane-tilt"></i>
                    <div class="logo-text-wrapper">
                        <span class="logo-full">FlightOps</span>
                        <span class="logo-mini">TFO</span>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                
                <a href="{{ url_for('Dashboard') }}" 
                   class="menu-link {{ 'ativo' if request.endpoint == 'Dashboard' else '' }}">
                   <div class="link-content">
                       <i class="ph-bold ph-chart-pie-slice"></i>
                       <span class="link-text">Dashboard</span>
                   </div>
                </a>

                {% if current_user.TemPermissao('cadastros.malha.editar') or 
                current_user.TemPermissao('cadastros.aeroportos.editar') or 
                current_user.TemPermissao('cadastros.cidades.editar') or 
                current_user.TemPermissao('cadastros.tabelas.editar') %}
                <div class="menu-group-wrapper">
                    <button class="menu-group-btn {{ 'ativo' if 'Malha' in request.endpoint or 'Aeroporto' in request.endpoint or 'Cidade' in request.endpoint or 'Frete' in request.endpoint else '' }}"
                            onclick="ToggleMenu(this)">
                        <div class="link-content">
                            <i class="ph-bold ph-folder-notch"></i>
                            <span class="link-text">Cadastros</span>
                        </div>
                        <i class="ph-bold ph-caret-down seta-menu"></i>
                    </button>
                    
                    <div class="submenu {{ 'aberto' if 'Malha' in request.endpoint or 'Aeroporto' in request.endpoint or 'Cidade' in request.endpoint or 'Frete' in request.endpoint else '' }}">
                        
                        {% if current_user.TemPermissao('cadastros.malha.editar') %}
                        <a href="{{ url_for('Malha.Gerenciar') }}" 
                           class="menu-link {{ 'ativo' if request.endpoint and 'Malha' in request.endpoint else '' }}">
                           <span class="link-text">Malha Aérea</span>
                        </a>
                        {% endif %}

                        {% if current_user.TemPermissao('cadastros.aeroportos.editar') %}
                        <a href="{{ url_for('Aeroporto.Gerenciar') }}" 
                           class="menu-link {{ 'ativo' if request.endpoint and 'Aeroporto' in request.endpoint else '' }}">
                           <span class="link-text">Aeroportos</span>
                        </a>
                        {% endif %}

                        {% if current_user.TemPermissao('cadastros.cidades.editar') %}
                        <a href="{{ url_for('Cidade.Gerenciar') }}" 
                           class="menu-link {{ 'ativo' if request.endpoint and 'Cidade' in request.endpoint else '' }}">
                           <span class="link-text">Cidades</span>
                        </a>
                        {% endif %}

                        {% if current_user.TemPermissao('cadastros.tabelas.editar') %}
                        <a href="{{ url_for('Frete.Gerenciar') }}" 
                           class="menu-link {{ 'ativo' if request.endpoint and 'Frete' in request.endpoint else '' }}">
                           <span class="link-text">Tabelas de Frete</span>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {% if current_user.TemPermissao('planejamento.visualizar') %}
                    <a href="{{ url_for('Planejamento.Dashboard') }}" 
                       class="menu-link {{ 'ativo' if request.endpoint and 'Planejamento' in request.endpoint else '' }}">
                        <div class="link-content">
                            <i class="ph-bold ph-globe-hemisphere-west"></i>
                            <span class="link-text">Planejamento</span>
                        </div>
                    </a>
                {% endif %}
                
                {% if current_user.TemPermissao('cadastros.malha.visualizar') %}
                <a href="{{ url_for('Escalas.Mapa') }}" 
                   class="menu-link {{ 'ativo' if request.endpoint and 'Escalas' in request.endpoint else '' }}">
                   <div class="link-content">
                       <i class="ph-bold ph-calendar-blank"></i>
                       <span class="link-text">Escalas</span>
                   </div>
                </a>
                {% endif %}

                {% if current_user.TemPermissao('acompanhamento.visualizar') %}
                <a href="{{ url_for('Acompanhamento.Painel') }}" 
                   class="menu-link {{ 'ativo' if request.endpoint and 'Acompanhamento' in request.endpoint else '' }}">
                   <div class="link-content">
                       <i class="ph-bold ph-airplane-in-flight"></i>
                       <span class="link-text">Acompanhamento</span>
                   </div>
                </a>
                {% endif %}

                {% if current_user.TemPermissao('reversa.visualizar') %}
                <a href="{{ url_for('Reversa.Index') }}" 
                   class="menu-link {{ 'ativo' if request.endpoint and 'Reversa' in request.endpoint else '' }}">
                   <div class="link-content">
                       <i class="ph-bold ph-arrow-u-down-left"></i>
                       <span class="link-text">Devoluções (Reversa)</span>
                    </div>
                </a>
                {% endif %}
                
                <div class="menu-divider"></div>
                {% if current_user.TemPermissao('sistema.configuracoes.visualizar') %}
                <a href="{{ url_for('Configuracoes.Index') }}" 
                   class="menu-link {{ 'ativo' if request.endpoint and 'Configuracoes' in request.endpoint else '' }}">
                    <div class="link-content">
                        <i class="ph-bold ph-gear"></i>
                        <span class="link-text">Configurações</span>
                    </div>
                </a>
                {% endif %}

            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">
                        <i class="ph-fill ph-user"></i>
                    </div>
                    <div class="user-info">
                        <span class="user-name">
                            {% if current_user.is_authenticated %}
                                {{ current_user.Login }}
                            {% else %}
                                Visitante
                            {% endif %}
                        </span>
                        <span class="user-role">Flight Dispatcher</span>
                    </div>
                </div>

                <div class="sidebar-actions">
                    <button onclick="AlternarTema()" class="action-btn" title="Alternar Tema">
                        <i class="ph-bold ph-moon"></i>
                    </button>

                    <a href="{{ url_for('Auth.Logout') }}" class="action-btn logout" title="Sair">
                        <i class="ph-bold ph-sign-out"></i>
                    </a>
                </div>

                <div class="version-info">
                    <span class="link-text">v{{ SistemaVersao.NumeroVersao }}</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="conteudo-pagina">
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    {% for category, message in messages %}
                      <div class="alert alert-{{ category }}">
                          <i class="ph-fill {% if category == 'success' %}ph-check-circle{% elif category == 'danger' %}ph-warning-circle{% else %}ph-info{% endif %}"></i>
                          <span>{{ message }}</span>
                      </div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}

                {% block conteudo %}{% endblock %}
            </div>
        </main>
    </div>
<script src="{{ url_for('static', filename='JS/Base.js') }}"></script>
</body>
</html>